package require tcltest
namespace import ::tcltest::test
namespace import ::tcltest::cleanupTests
namespace import ::tcltest::testConstraint

set files [lsort [glob -nocomplain "~/ci-development/tcl/*.tcl"]]

foreach file $files {
    source $file
}

test proc_lengths-1.0 \
    {Get body length of procs in a string.} \
    -body {
        set test {
            proc test_1 {args} {
                # This is a test proc.
                return 1
            }

            proc test_2 {} {
                set foo 1
                set bar 2

                return [expr {$foo + $bar}]
            }

            namespace eval tests {

                namespace export test_3

                namespace ensemble create

                proc test_3 {args} {
                    #| Ensemble proc.

                    return "a"
                }
            }

            namespace eval test_vars {
                set vars [list]
                lappend vars \
                    [dict create \
                         a 1 \
                         b 2 \
                         c 3] \
                    [dict create \
                         a 4 \
                         b 5 \
                         c 6]

                proc test_4 {args} {
                    return 4
                }
            }

            proc test_5 {} {
                return {select a, b, c from test where id = 123}
            }

            proc test_6 {} {
                db_1row {
                    select
                    a,
                    b,
                    c

                    from test
                }

                db_dml {
                    update test
                    set a = :c
                    where id = :b
                }

                db_dml {
                    insert into test
                    (a, b, c)
                    values
                    (1, 2, 3)
                }

                db_dml {
                    delete from test
                }

                return 1
            }
        }

        return [proc_lengths $test]
    } \
    -result {test_1 2 test_2 4 test_3 3 test_4 1 test_5 1 test_6 9}

cleanupTests
