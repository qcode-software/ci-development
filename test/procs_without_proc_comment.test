package require tcltest
namespace import ::tcltest::test
namespace import ::tcltest::cleanupTests
namespace import ::tcltest::testConstraint

set files [lsort [glob -nocomplain "~/ci-development/tcl/*.tcl"]]

foreach file $files {
    source $file
}

set setup {
    set test_file "~/ci-development/test/files/linter_test.tcl"
}

test procs_without_proc_comment-1.0 \
    {Get procs that don't have a proc comment.} \
    -body {
        set procs [procs_without_proc_comment {
            proc test_1 {args} {

                #| Test 1 proc.
                return 1
            }

            proc test_2 {args} {
                return 2
            }

            namespace eval test {
                namespace export test_3
                namespace ensemble create

                proc test_3 {args} {
                    #| Test 3 proc.
                    return 3
                }

                proc test_4 {args} {
                    return 4
                }
            }
        }]

        if { [llength $procs] != 2 } {
            error "Expected 2 procs but got [llength $procs]: $procs."
        }

        if { "test_2" ni $procs } {
            error "Proc test_2 not found."
        }

        if { "test_4" ni $procs } {
            error "Proc test_4 not found."
        }

        return 1
    } \
    -result 1

test procs_without_proc_comment_report-1.0 \
    {Report procs without a proc comment.} \
    -setup $setup \
    -body {
        set report [procs_without_proc_comment_report [list $test_file]]

        return [expr { [string length $report] > 0 }]
    } \
    -result 1

test procs_without_proc_comment_count-1.0 \
    {Count procs that don't have a proc comment.} \
    -setup $setup \
    -body {
        return [procs_without_proc_comment_count [list $test_file]]
    } \
    -result 1

cleanupTests
